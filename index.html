<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A retro-futuristic terminal-style life tracking application inspired by Fallout Pip-Boy">
    <title>LIFE: TERMINAL v1.0</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            background: url('https://i.imgur.com/7v0Q4rT.png') no-repeat center center fixed; /* Retro-futuristic Pip-Boy-like metallic texture */
            background-size: cover;
            font-family: 'VT323', monospace; /* Pure terminal font, no bold/italic */
            color: #ff9900; /* Vibrant orange for retro-futuristic glow */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* Prevent scroll overflow for Pip-Boy effect */
            filter: brightness(0.9) contrast(1.2); /* CRT-like enhancement */
        }

        .terminal {
            background: rgba(0, 0, 0, 0.85); /* Semi-transparent black for Pip-Boy screen */
            border: 4px ridge #ff9900; /* Ridged border for rugged, futuristic hardware */
            padding: 20px;
            width: 90%;
            max-width: 900px;
            box-shadow: 0 0 30px rgba(255, 153, 0, 0.7), inset 0 0 20px rgba(255, 153, 0, 0.5); /* Strong glowing edges */
            position: relative;
            border-radius: 10px; /* Rounded edges for futuristic flair */
            animation: terminalGlow 4s infinite alternate; /* Pulsing holographic glow */
        }

        @keyframes terminalGlow {
            0% { box-shadow: 0 0 25px rgba(255, 153, 0, 0.6), inset 0 0 15px rgba(255, 153, 0, 0.4); }
            100% { box-shadow: 0 0 40px rgba(255, 153, 0, 0.9), inset 0 0 25px rgba(255, 153, 0, 0.7); }
        }

        .terminal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255, 153, 0, 0.15) 0%, transparent 80%);
            pointer-events: none; /* Holographic radial glow */
        }

        .header {
            text-align: right;
            font-size: 14px;
            margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(255, 153, 0, 0.8); /* Enhanced glowing text */
            animation: headerBlink 2s infinite alternate; /* Subtle blink */
        }

        @keyframes headerBlink {
            0% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .user-info {
            margin-bottom: 20px;
            border: 2px ridge #ff9900; /* Ridged for rugged Pip-Boy panel */
            padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.4);
            animation: infoPulse 3s infinite alternate; /* Gentle pulsing */
        }

        @keyframes infoPulse {
            0% { box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.4); }
            100% { box-shadow: inset 0 0 15px rgba(255, 153, 0, 0.6); }
        }

        .content {
            display: none;
            padding: 15px 0;
        }

        .content.active {
            display: block;
        }

        .section {
            margin-bottom: 15px;
            border: 2px ridge #ff9900; /* Ridged for Pip-Boy panels */
            padding: 15px;
            background: rgba(0, 0, 0, 0.65); /* Darker for depth */
            box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3);
            animation: sectionFade 2s infinite alternate; /* Smooth fade */
        }

        @keyframes sectionFade {
            0% { box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3); }
            100% { box-shadow: inset 0 0 15px rgba(255, 153, 0, 0.5); }
        }

        .stats-item, .log-group, .goal-group {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-field, .goal-input {
            width: 65%;
            margin: 5px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px groove #ff9900;
            color: #ff9900;
            font-family: 'VT323', monospace;
            box-shadow: inset 0 0 8px rgba(255, 153, 0, 0.4);
            transition: box-shadow 0.3s, border-color 0.3s;
        }

        .input-field:focus, .goal-input:focus {
            box-shadow: inset 0 0 12px rgba(255, 153, 0, 0.7), 0 0 12px rgba(255, 153, 0, 0.6);
            border-color: #ffcc00; /* Brighter orange on focus */
            outline: none;
        }

        .log-button, .toggle-button, .complete-day-button, .update-goal-button {
            background: #ff6600; /* Brighter orange for Pip-Boy buttons */
            border: 2px ridge #ff9900;
            padding: 8px 15px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 8px rgba(255, 153, 0, 0.7);
            animation: buttonGlow 2s infinite alternate; /* Subtle button glow */
        }

        @keyframes buttonGlow {
            0% { box-shadow: 0 0 8px rgba(255, 153, 0, 0.7); }
            100% { box-shadow: 0 0 12px rgba(255, 153, 0, 0.9); }
        }

        .log-button:hover, .toggle-button:hover, .complete-day-button:hover, .update-goal-button:hover {
            background: #cc5500; /* Darker orange on hover */
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.9);
        }

        .achievements-grid, .daily-achievements-grid, .history-grid, .weekly-challenge-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .achievement, .daily-achievement, .history-entry, .weekly-challenge {
            background: rgba(0, 0, 0, 0.65);
            border: 2px ridge #ff9900; /* Ridged for Pip-Boy panels */
            padding: 15px;
            text-align: center;
            font-size: 14px;
            box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3);
            animation: dataBlink 2.5s infinite alternate; /* Subtle data blink */
        }

        @keyframes dataBlink {
            0% { box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3); }
            100% { box-shadow: inset 0 0 15px rgba(255, 153, 0, 0.5); }
        }

        .achievement-progress {
            margin-top: 8px;
            font-size: 12px;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px ridge #ff9900;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3);
            animation: tabPulse 3s infinite alternate; /* Pulsing tab bar */
        }

        @keyframes tabPulse {
            0% { box-shadow: inset 0 0 10px rgba(255, 153, 0, 0.3); }
            100% { box-shadow: inset 0 0 15px rgba(255, 153, 0, 0.5); }
        }

        .tab {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: background-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 0 8px rgba(255, 153, 0, 0.2);
        }

        .tab:hover {
            background: rgba(51, 51, 51, 0.7);
            box-shadow: inset 0 0 12px rgba(255, 153, 0, 0.5);
        }

        .tab.active {
            background: #ff9900;
            color: #000000;
            box-shadow: inset 0 0 20px rgba(255, 153, 0, 0.9);
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="header">
            16:21:26 | 20/02/2025
        </div>

        <div class="user-info">
            Name: <span id="userName">Default User</span> | 
            Age: <span id="userAge">30</span> | 
            Level: <span id="userLevel">1</span> | 
            XP: <span id="userXp">0/100</span>
        </div>

        <div class="tabs">
            <div class="tab" data-tab="main">STATUS</div>
            <div class="tab" data-tab="stats">DATA</div>
            <div class="tab" data-tab="achievements">BADGES</div>
            <div class="tab" data-tab="history">LOGS</div>
            <div class="tab" data-tab="settings">CONFIG</div>
        </div>

        <div class="content main active">
            <div class="section">
                <h2>VITAL READOUTS</h2>
                <div class="stats-item">Sleep Duration: <span id="sleepDuration">8h</span></div>
                <div class="stats-item">Weight: <span id="weight">78.5</span></div>
                <div class="stats-item">Steps: <span id="steps">8432</span> / <span id="stepsGoal">10000</span></div>
                <div class="stats-item">Calories: <span id="calories">2100</span> / <span id="caloriesGoal">2000</span></div>
                <div class="stats-item">Screen Time: <span id="screenTime">5.2</span></div>
                <div class="stats-item">Gym Session: <span id="gymSession">Completed</span></div>
            </div>

            <div class="section">
                <h2>INPUT MODULE</h2>
                <div class="log-group">
                    <input type="text" class="input-field" id="logSleepDuration" placeholder="Sleep Duration (hh)">
                    <button class="log-button" onclick="logStat('sleepDuration')">LOG</button>
                </div>
                <div class="log-group">
                    <input type="text" class="input-field" id="logWeight" placeholder="Weight">
                    <button class="log-button" onclick="logStat('weight')">LOG</button>
                </div>
                <div class="log-group">
                    <input type="text" class="input-field" id="logSteps" placeholder="Steps">
                    <button class="log-button" onclick="logStat('steps')">LOG</button>
                </div>
                <div class="log-group">
                    <input type="text" class="input-field" id="logCalories" placeholder="Calories">
                    <button class="log-button" onclick="logStat('calories')">LOG</button>
                </div>
                <div class="log-group">
                    <input type="text" class="input-field" id="logScreenTime" placeholder="Screen Time (hrs)">
                    <button class="log-button" onclick="logStat('screenTime')">LOG</button>
                </div>
                <button class="toggle-button" onclick="toggleGymSession()">TOGGLE GYM SESSION</button>
                <button class="complete-day-button" onclick="completeDay()">FINALIZE DAY</button>
            </div>

            <div class="section">
                <h2>DAILY OBJECTIVES</h2>
                <div class="daily-achievements-grid" id="dailyAchievementsList">
                    <!-- Daily achievements will be populated via JavaScript -->
                </div>
            </div>
        </div>

        <div class="content stats">
            <div class="section">
                <h2>ANALYTICS HUB</h2>
                <p>Steps: <span id="statsSteps">8432</span> / <span id="statsStepsGoal">10000</span> | 
                   Calories: <span id="statsCalories">2100</span> / <span id="statsCaloriesGoal">2000</span> | 
                   Sleep: <span id="statsSleep">8h</span> / <span id="statsSleepGoal">8h</span> | 
                   XP: <span id="statsXp">0</span></p>
            </div>
        </div>

        <div class="content achievements">
            <div class="section">
                <h2>BADGE ARCHIVE</h2>
                <div class="achievements-grid" id="achievementsList">
                    <!-- Achievements will be populated via JavaScript -->
                </div>
            </div>
        </div>

        <div class="content history">
            <div class="section">
                <h2>LOG ARCHIVES</h2>
                <div class="history-grid" id="historyList">
                    <!-- History entries will be populated via JavaScript -->
                </div>
            </div>
        </div>

        <div class="content settings">
            <div class="section">
                <h2>CONFIG TERMINAL</h2>
                <p>Profile Setup:</p>
                <input type="text" class="input-field" id="editName" placeholder="Enter/Update Name">
                <button class="log-button" onclick="updateUserProfile('name')">UPDATE NAME</button>
                <input type="number" class="input-field" id="editAge" placeholder="Enter/Update Age">
                <button class="log-button" onclick="updateUserProfile('age')">UPDATE AGE</button>
                <h3>Daily Goals:</h3>
                <div class="goal-group">
                    <input type="text" class="goal-input" id="editStepsGoal" placeholder="Steps Goal (e.g., 10000)">
                    <button class="update-goal-button" onclick="updateGoal('steps')">UPDATE</button>
                </div>
                <div class="goal-group">
                    <input type="text" class="goal-input" id="editCaloriesGoal" placeholder="Calories Goal (e.g., 2000)">
                    <button class="update-goal-button" onclick="updateGoal('calories')">UPDATE</button>
                </div>
                <div class="goal-group">
                    <input type="text" class="goal-input" id="editSleepGoal" placeholder="Sleep Goal (hh, e.g., 8)">
                    <button class="update-goal-button" onclick="updateGoal('sleep')">UPDATE</button>
                </div>
                <h3>Weekly Gym Challenge:</h3>
                <div class="goal-group">
                    <input type="text" class="goal-input" id="editGymGoal" placeholder="Gym Sessions/Week (e.g., 3)">
                    <button class="update-goal-button" onclick="updateGoal('gym')">UPDATE</button>
                </div>
                <div class="weekly-challenge-grid" id="weeklyChallengeList">
                    <!-- Weekly challenge will be populated via JavaScript -->
                </div>
                <p>Theme: Retro-Futuristic | Notifications: On</p>
            </div>
        </div>
    </div>

    <script>
        // Initial data (stored in localStorage as JSON)
        let userProfile = {
            name: "Default User",
            age: 30
        };

        let stats = {
            level: 1,
            xp: 0,
            maxXp: 100,
            sleepDuration: "8h",
            weight: "78.5",
            steps: "8432",
            calories: "2100",
            screenTime: "5.2",
            gymSession: "Completed",
            logs: [],
            dayCompleted: false, // Track if the day is marked as finished
            gymSessionsThisWeek: 0 // Track gym sessions for weekly challenge
        };

        let goals = {
            steps: "10000",
            calories: "2000",
            sleep: "8",
            gymWeekly: "3" // Target gym sessions per week (Monday to Sunday)
        };

        let achievements = [
            { name: "Early Bird", status: "IN PROGRESS", progress: 0, target: 7, xp: 20 }, // 7+ days 7-9h sleep
            { name: "Gym Warrior", status: "IN PROGRESS", progress: 0, target: 5, xp: 25 }, // 5+ gym sessions total
            { name: "Nutrition Master", status: "IN PROGRESS", progress: 0, target: 14, xp: 15 }, // 14+ days meeting calories goal
            { name: "Step Master", status: "IN PROGRESS", progress: 0, target: 7, xp: 20 }, // 7+ days meeting steps goal
            { name: "Sleep Guardian", status: "IN PROGRESS", progress: 0, target: 14, xp: 15 }, // 14+ days meeting sleep goal
            { name: "Digital Wellness", status: "IN PROGRESS", progress: 0, target: 7, xp: 10 } // 7+ days â‰¤4h screen
        ];

        let dailyAchievements = [
            { name: "Morning Jog", status: "IN PROGRESS", xp: 20, condition: steps => parseInt(steps) >= parseInt(goals.steps) },
            { name: "Healthy Meal", status: "IN PROGRESS", xp: 15, condition: calories => parseInt(calories) >= parseInt(goals.calories) },
            { name: "Screen Break", status: "IN PROGRESS", xp: 10, condition: screenTime => parseFloat(screenTime) <= 4 }
        ];

        let history = []; // Array to store daily history
        let weekStart = new Date(); // Track current week's start (Monday)
        weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1); // Set to Monday

        // Load or save data to localStorage
        function loadData() {
            const savedUser = localStorage.getItem('userProfile');
            const savedStats = localStorage.getItem('stats');
            const savedGoals = localStorage.getItem('goals');
            const savedAchievements = localStorage.getItem('achievements');
            const savedDaily = localStorage.getItem('dailyAchievements');
            const savedHistory = localStorage.getItem('history');
            if (savedUser) userProfile = JSON.parse(savedUser);
            if (savedStats) stats = JSON.parse(savedStats);
            if (savedGoals) goals = JSON.parse(savedGoals);
            if (savedAchievements) achievements = JSON.parse(savedAchievements);
            if (savedDaily) {
                dailyAchievements = JSON.parse(savedDaily);
                checkDailyReset();
            }
            if (savedHistory) history = JSON.parse(savedHistory);
            checkWeeklyReset();
            updateDisplay();
            renderAchievements();
            renderDailyAchievements();
            renderHistory();
            renderWeeklyChallenge();
        }

        function saveData() {
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            localStorage.setItem('stats', JSON.stringify(stats));
            localStorage.setItem('goals', JSON.stringify(goals));
            localStorage.setItem('achievements', JSON.stringify(achievements));
            localStorage.setItem('dailyAchievements', JSON.stringify(dailyAchievements));
            localStorage.setItem('history', JSON.stringify(history));
        }

        // Check if daily achievements need to reset
        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastReset = localStorage.getItem('lastDailyReset');
            if (lastReset !== today) {
                dailyAchievements.forEach(ach => ach.status = "IN PROGRESS");
                stats.logs = []; // Clear daily logs
                stats.dayCompleted = false; // Reset day completion status
                localStorage.setItem('lastDailyReset', today);
                saveData();
            }
        }

        // Check if weekly gym challenge needs to reset
        function checkWeeklyReset() {
            const now = new Date();
            const currentWeekStart = new Date(weekStart);
            if (now.getTime() >= currentWeekStart.getTime() + 7 * 24 * 60 * 60 * 1000) { // 7 days later
                stats.gymSessionsThisWeek = 0; // Reset weekly gym sessions
                weekStart = new Date(now);
                weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1); // Reset to Monday
                saveData();
            }
        }

        // Update display for stats and user info
        function updateDisplay() {
            document.getElementById('userName').textContent = userProfile.name || 'Default User';
            document.getElementById('userAge').textContent = userProfile.age || '30';
            document.getElementById('userLevel').textContent = stats.level;
            document.getElementById('userXp').textContent = `${stats.xp}/${stats.maxXp}`;
            document.getElementById('sleepDuration').textContent = stats.sleepDuration || '8h';
            document.getElementById('weight').textContent = stats.weight || '--';
            document.getElementById('steps').textContent = stats.steps || '0';
            document.getElementById('stepsGoal').textContent = goals.steps;
            document.getElementById('calories').textContent = stats.calories || '0';
            document.getElementById('caloriesGoal').textContent = goals.calories;
            document.getElementById('screenTime').textContent = stats.screenTime || '0';
            document.getElementById('gymSession').textContent = stats.gymSession || 'Not Completed';
            
            // Update stats tab
            document.getElementById('statsSteps').textContent = stats.steps || '0';
            document.getElementById('statsStepsGoal').textContent = goals.steps;
            document.getElementById('statsCalories').textContent = stats.calories || '0';
            document.getElementById('statsCaloriesGoal').textContent = goals.calories;
            document.getElementById('statsSleep').textContent = stats.sleepDuration || '8h';
            document.getElementById('statsSleepGoal').textContent = goals.sleep;
            document.getElementById('statsXp').textContent = stats.xp || '0';
        }

        // Render achievements with progress
        function renderAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            achievements.forEach(ach => {
                const div = document.createElement('div');
                div.className = 'achievement';
                div.innerHTML = `${ach.name}\n${ach.status}\nProgress: ${ach.progress}/${ach.target}`;
                achievementsList.appendChild(div);
            });
        }

        // Render daily achievements
        function renderDailyAchievements() {
            const dailyList = document.getElementById('dailyAchievementsList');
            dailyList.innerHTML = '';
            dailyAchievements.forEach(ach => {
                const div = document.createElement('div');
                div.className = 'daily-achievement';
                div.innerHTML = `${ach.name} (+${ach.xp} XP)\n${ach.status}`;
                dailyList.appendChild(div);
            });
        }

        // Render history (including today's stats if day is completed)
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();

            // Show today's stats if day is marked as completed
            if (stats.dayCompleted) {
                const todayEntry = {
                    date: today,
                    sleepDuration: stats.sleepDuration,
                    weight: stats.weight,
                    steps: stats.steps,
                    calories: stats.calories,
                    screenTime: stats.screenTime,
                    gymSession: stats.gymSession
                };
                const todayDiv = document.createElement('div');
                todayDiv.className = 'history-entry';
                todayDiv.innerHTML = `Date: ${todayEntry.date}\n` +
                    `Sleep: ${todayEntry.sleepDuration || '8h'}\n` +
                    `Weight: ${todayEntry.weight || '--'}\n` +
                    `Steps: ${todayEntry.steps || '0'}\n` +
                    `Calories: ${todayEntry.calories || '0'}\n` +
                    `Screen: ${todayEntry.screenTime || '0'}\n` +
                    `Gym: ${todayEntry.gymSession || 'Not Completed'}`;
                historyList.appendChild(todayDiv);
            }

            // Show yesterday's entries
            const yesterdayEntries = history.filter(entry => entry.date === yesterdayStr);
            if (yesterdayEntries.length > 0) {
                yesterdayEntries.forEach(entry => {
                    const div = document.createElement('div');
                    div.className = 'history-entry';
                    div.innerHTML = `Date: ${entry.date}\n` +
                        `Sleep: ${entry.sleepDuration || '8h'}\n` +
                        `Weight: ${entry.weight || '--'}\n` +
                        `Steps: ${entry.steps || '0'}\n` +
                        `Calories: ${entry.calories || '0'}\n` +
                        `Screen: ${entry.screenTime || '0'}\n` +
                        `Gym: ${entry.gymSession || 'Not Completed'}`;
                    historyList.appendChild(div);
                });
            } else if (!stats.dayCompleted) {
                historyList.innerHTML = 'No logs available. Finalize the day to save today\'s data.';
            }
        }

        // Render weekly gym challenge
        function renderWeeklyChallenge() {
            const challengeList = document.getElementById('weeklyChallengeList');
            challengeList.innerHTML = '';
            const div = document.createElement('div');
            div.className = 'weekly-challenge';
            div.innerHTML = `Weekly Gym Goal: ${stats.gymSessionsThisWeek}/${goals.gymWeekly} sessions\nWeek: ${weekStart.toDateString()} - ${new Date(weekStart.getTime() + 6 * 24 * 60 * 60 * 1000).toDateString()}`;
            challengeList.appendChild(div);
        }

        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.querySelector(`.content.${tabId}`).classList.add('active');
                console.log(`Switched to ${tabId} tab at ${new Date().toLocaleTimeString()}`);
            });
        });

        // Intuitive logging system (updated for sleep duration only)
        function logStat(statType) {
            const inputId = `log${statType.charAt(0).toUpperCase() + statType.slice(1)}`;
            const value = document.getElementById(inputId).value;
            if (value) {
                stats[statType] = value + (statType === 'sleepDuration' ? 'h' : '');
                stats.logs.push({ timestamp: new Date().toLocaleTimeString(), type: statType, value });
                if (statType === 'gymSession' && stats.gymSession === "Completed") {
                    stats.gymSessionsThisWeek++;
                }
                awardXp(statType === 'steps' ? value : null,
                        statType === 'calories' ? value : null,
                        statType === 'screenTime' ? value : null,
                        statType === 'gymSession' ? stats.gymSession : null,
                        statType === 'sleepDuration' ? value : null);
                document.getElementById(inputId).value = '';
                saveData();
                updateDisplay();
                updateAchievements();
                checkDailyAchievements();
                renderWeeklyChallenge();
            }
        }

        function toggleGymSession() {
            stats.gymSession = stats.gymSession === "Completed" ? "Not Completed" : "Completed";
            stats.logs.push({ timestamp: new Date().toLocaleTimeString(), type: "gymSession", value: stats.gymSession });
            if (stats.gymSession === "Completed") {
                stats.gymSessionsThisWeek++;
            }
            awardXp(null, null, null, stats.gymSession);
            saveData();
            updateDisplay();
            updateAchievements();
            checkDailyAchievements();
            renderWeeklyChallenge();
        }

        // Update user profile
        function updateUserProfile(field) {
            const inputId = `edit${field.charAt(0).toUpperCase() + field.slice(1)}`;
            const value = document.getElementById(inputId).value;
            if (value) {
                if (field === 'name') userProfile.name = value;
                else if (field === 'age') userProfile.age = parseInt(value) || userProfile.age;
                document.getElementById(inputId).value = '';
                saveData();
                updateDisplay();
            }
        }

        // Update goals
        function updateGoal(goalType) {
            const inputId = `edit${goalType.charAt(0).toUpperCase() + goalType.slice(1)}Goal`;
            const value = document.getElementById(inputId).value;
            if (value) {
                if (goalType === 'steps' || goalType === 'calories') goals[goalType] = value;
                else if (goalType === 'sleep') goals.sleep = value + 'h';
                else if (goalType === 'gym') goals.gymWeekly = value;
                document.getElementById(inputId).value = '';
                saveData();
                updateDisplay();
                // Update daily achievement conditions
                dailyAchievements[0].condition = steps => parseInt(steps) >= parseInt(goals.steps);
                dailyAchievements[1].condition = calories => parseInt(calories) >= parseInt(goals.calories);
                dailyAchievements[2].condition = screenTime => parseFloat(screenTime) <= 4; // Screen Break unchanged
            }
        }

        // Complete day and save history
        function completeDay() {
            const today = new Date().toDateString();
            const dailyEntry = {
                date: today,
                sleepDuration: stats.sleepDuration,
                weight: stats.weight,
                steps: stats.steps,
                calories: stats.calories,
                screenTime: stats.screenTime,
                gymSession: stats.gymSession
            };
            history.push(dailyEntry);
            stats.logs = []; // Clear daily logs
            stats.dayCompleted = true; // Mark day as completed
            checkDailyReset(); // Reset daily achievements
            saveData();
            updateDisplay();
            renderHistory();
        }

        // Calculate sleep duration (simplified for logging)
        function calculateSleepDuration(duration) {
            return duration + 'h'; // Assume input is hours, append 'h' for consistency
        }

        // Award XP and update achievements
        function awardXp(steps = null, calories = null, screenTime = null, gymSession = null, sleepDuration = null) {
            let xpGain = 0;
            if (steps && parseInt(steps) >= parseInt(goals.steps)) xpGain += 20; // Step Master (based on goal)
            if (calories && parseInt(calories) >= parseInt(goals.calories)) xpGain += 15; // Nutrition (based on goal)
            if (screenTime && parseFloat(screenTime) <= 4) xpGain += 10; // Digital Wellness
            if (gymSession === "Completed") xpGain += 25; // Gym Warrior
            if (sleepDuration) {
                const [hours] = sleepDuration.split('h').map(Number);
                const sleepGoal = parseInt(goals.sleep);
                if (hours >= 7 && hours <= 9 && hours === sleepGoal) xpGain += 15; // Early Bird/Sleep Guardian (based on goal)
            }

            stats.xp += xpGain;
            while (stats.xp >= stats.maxXp) {
                stats.xp -= stats.maxXp;
                stats.level += 1;
                stats.maxXp += 50;
            }
            saveData();
        }

        // Update achievements progress
        function updateAchievements() {
            achievements.forEach(ach => {
                if (ach.status === "IN PROGRESS") {
                    const today = new Date().toDateString();
                    const lastUpdate = localStorage.getItem(`last${ach.name}Update`) || '';
                    if (lastUpdate !== today) {
                        switch (ach.name) {
                            case "Early Bird":
                            case "Sleep Guardian":
                                const [hours] = stats.sleepDuration.split('h').map(Number);
                                if (hours >= 7 && hours <= 9 && hours === parseInt(goals.sleep)) ach.progress++;
                                break;
                            case "Gym Warrior":
                                if (stats.gymSession === "Completed") ach.progress++;
                                break;
                            case "Nutrition Master":
                                if (parseInt(stats.calories) >= parseInt(goals.calories)) ach.progress++;
                                break;
                            case "Step Master":
                                if (parseInt(stats.steps) >= parseInt(goals.steps)) ach.progress++;
                                break;
                            case "Digital Wellness":
                                if (parseFloat(stats.screenTime) <= 4) ach.progress++;
                                break;
                        }
                        localStorage.setItem(`last${ach.name}Update`, today);
                    }
                    if (ach.progress >= ach.target) {
                        ach.status = "COMPLETED";
                        stats.xp += ach.xp;
                    }
                    // Check weekly gym challenge for Gym Warrior
                    if (ach.name === "Gym Warrior" && stats.gymSessionsThisWeek >= parseInt(goals.gymWeekly)) {
                        ach.status = "COMPLETED";
                        stats.xp += ach.xp;
                    }
                }
            });
            renderAchievements();
            saveData();
        }

        // Check and update daily achievements
        function checkDailyAchievements() {
            dailyAchievements.forEach(ach => {
                if (ach.status === "IN PROGRESS" && ach.condition(stats[ach.name.split(' ')[0].toLowerCase()])) {
                    ach.status = "COMPLETED";
                    stats.xp += ach.xp;
                }
            });
            renderDailyAchievements();
            saveData();
        }

        // Initialize
        loadData();
        // Set Main tab as active by default
        document.querySelector('.tab[data-tab="main"]').classList.add('active');
    </script>
</body>
</html>
